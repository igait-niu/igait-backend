<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="iGait ASD - Backend"><title>igait_backend - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="igait_backend" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../static.files/storage-59e33391.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../igait_backend/index.html">igait_<wbr>backend</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#igait-asd---backend" title="iGait ASD - Backend">iGait ASD - Backend</a></li><li><a href="#other-repositories-and-documents" title="Other Repositories and Documents">Other Repositories and Documents</a><ul><li><a href="#email" title="Email">Email</a></li><li><a href="#metis" title="Metis">Metis</a></li></ul></li><li><a href="#table-of-contents" title="Table of Contents">Table of Contents</a></li><li><a href="#1---api" title="1 - API">1 - API</a><ul><li><a href="#11---layout-and-explanation" title="1.1 - Layout and Explanation">1.1 - Layout and Explanation</a></li><li><a href="#12---notes" title="1.2 - Notes">1.2 - Notes</a></li></ul></li><li><a href="#2---codebase-structure" title="2 - Codebase Structure">2 - Codebase Structure</a></li><li><a href="#3---setting-up-your-development-environment" title="3 - Setting Up Your Development Environment">3 - Setting Up Your Development Environment</a><ul><li><a href="#31---installation" title="3.1 - Installation">3.1 - Installation</a></li><li><a href="#32---secrets" title="3.2 - Secrets">3.2 - Secrets</a></li><li><a href="#33---download-the-igait-backend-repository" title="3.3 - Download the `igait-backend` Repository">3.3 - Download the <code>igait-backend</code> Repository</a></li><li><a href="#34---development-and-deployment-command-list" title="3.4 - Development and Deployment Command List">3.4 - Development and Deployment Command List</a></li></ul></li><li><a href="#4---ground-up-explanation-of-backend-service-selection" title="4 - Ground-up Explanation of Backend Service Selection">4 - Ground-up Explanation of Backend Service Selection</a><ul><li><a href="#40---about" title="4.0 - About">4.0 - About</a></li><li><a href="#41---how-to-extract-gait-parameters" title="4.1 - How to Extract Gait Parameters">4.1 - How to Extract Gait Parameters</a></li><li><a href="#42---consumer-devices-are-often-low-in-computation-power" title="4.2 - Consumer Devices are Often Low in Computation Power">4.2 - Consumer Devices are Often Low in Computation Power</a></li><li><a href="#43---planning-for-the-inference-process" title="4.3 - Planning for The Inference Process">4.3 - Planning for The Inference Process</a></li><li><a href="#the-backend" title="The Backend">The Backend</a></li></ul></li><li><a href="#more" title="More">More</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>igait_backend</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/igait_backend/main.rs.html#1-95">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="igait-asd---backend"><a class="doc-anchor" href="#igait-asd---backend">¬ß</a>iGait ASD - Backend</h2>
<p>This is the primary brain behind everything in the iGait app. There are a variety of microservices involved with the submission, upload, storage, and more - this server handles all of this to bring our product to the convenience of a low-power mobile device.</p>
<h2 id="other-repositories-and-documents"><a class="doc-anchor" href="#other-repositories-and-documents">¬ß</a>Other Repositories and Documents</h2>
<p>Helpful links and documentation for other sources is also in this documentation.</p>
<h4 id="email"><a class="doc-anchor" href="#email">¬ß</a>Email</h4>
<ul>
<li><a href="helper/email/index.html" title="mod igait_backend::helper::email">Email Documentation</a></li>
<li><a href="https://github.com/igait-niu/igait-email"><code>igait-email</code> GitHub Repository</a></li>
<li><a href="https://dash.cloudflare.com/4e56fe676d50c0b04e4593542eb465f2/workers/services/view/email-service/production?versionFilter=all">Cloudflare Worker</a></li>
</ul>
<h4 id="metis"><a class="doc-anchor" href="#metis">¬ß</a>Metis</h4>
<ul>
<li><a href="https://www.niu.edu/crcd/current-users/getting-started/login-to-metis.shtml">How to Login</a></li>
<li><a href="https://www.niu.edu/crcd/current-users/getting-started/queue-commands-job-management.shtml">(NIU‚Äôs) Documentation on Metis</a></li>
<li><a href="helper/metis/index.html" title="mod igait_backend::helper::metis">(My) Documentation on Metis</a></li>
</ul>
<h2 id="table-of-contents"><a class="doc-anchor" href="#table-of-contents">¬ß</a>Table of Contents</h2>
<ul>
<li><a href="#1---api">1</a> - API
<ul>
<li><a href="#11---layout-and-explanation">1.1</a> - Layout and Explanation</li>
<li><a href="#12---notes">1.2</a> - Notes</li>
</ul>
</li>
<li><a href="#2---codebase-structure">2</a> - Codebase Structure</li>
<li><a href="#3---setting-up-your-development-environment">3</a> - Setting Up Your Development Environment
<ul>
<li><a href="#31---installation">3.1</a> - Installation
<ul>
<li><a href="#311---nix-recommended">3.1.1</a> - Nix (recommended)</li>
<li><a href="#312---individual-installation-alternative-to-nix">3.1.2</a> - Individual Installation (alternative to Nix)</li>
</ul>
</li>
<li><a href="#32---secrets">3.2</a> - Secrets</li>
<li><a href="#33---download-the-igait-backend-repository">3.3</a> - Download the <code>igait-backend</code> Repository</li>
<li><a href="#34---development-and-deployment-command-list">3.4</a> - Development and Deployment Command List
<ul>
<li><a href="#341---running-the-backend-locally">3.4.1</a> - Running the Backend Locally</li>
<li><a href="#342---building-and-running-release-binary-locally">3.4.2</a> - Building and Running Release Binary Locally</li>
<li><a href="#343---docker-build-and-run">3.4.3</a> - Docker Build and Run</li>
<li><a href="#344---nix-build-and-run">3.4.4</a> - Nix Build and Run</li>
<li><a href="#345---aws-pull-and-deploy-from-ghcr">3.4.5</a> - AWS Pull and Deploy From GHCR</li>
<li><a href="#346---aws-startup-from-stopped">3.4.6</a> - AWS Startup from Stopped</li>
<li><a href="#347---rust-docs-build">3.4.7</a> - Rust Docs Build</li>
</ul>
</li>
</ul>
</li>
<li><a href="#4---ground-up-explanation-of-backend-service-selection">4</a> - Ground-up Explanation of Backend Service Selection</li>
</ul>
<h2 id="1---api"><a class="doc-anchor" href="#1---api">¬ß</a>1 - API</h2><h4 id="11---layout-and-explanation"><a class="doc-anchor" href="#11---layout-and-explanation">¬ß</a>1.1 - Layout and Explanation</h4>
<p>The API has three routes:</p>
<ul>
<li><a href="routes/historical/index.html" title="mod igait_backend::routes::historical"><code>api/v1/historical_submissions</code></a></li>
<li><a href="routes/upload/index.html" title="mod igait_backend::routes::upload"><code>api/v1/upload</code></a></li>
</ul>
<p>In the lifecycle of a job, first, the patient information and files are uploaded to the server via the <code>upload</code> route.
Then, the job is processed by the server, and eventually shipped to <strong>Metis</strong>.
Next, the server waits until Metis has completed processing (by scanning the <code>inputs</code> folder)
Finally, the server pulls the outputs from Metis into the <code>outputs</code> folder and processes/records them.</p>
<p>To learn more about why the API is designed how it is, or more about how it works, skip to the <a href="#">API section</a>.</p>
<p>To see more information about a specific route, see <a href="routes/index.html" title="mod igait_backend::routes">the routes module</a>.</p>
<h4 id="12---notes"><a class="doc-anchor" href="#12---notes">¬ß</a>1.2 - Notes</h4>
<ul>
<li>The API is currently versioned at <code>v1</code>, meaning every route is actually at <code>/api/v1/&lt;route&gt;</code>.</li>
<li>The <code>upload</code> and <code>historical_submissions</code> endpoints are public</li>
</ul>
<h2 id="2---codebase-structure"><a class="doc-anchor" href="#2---codebase-structure">¬ß</a>2 - Codebase Structure</h2>
<p><img src="https://github.com/user-attachments/assets/3eaebabc-ac73-4041-a866-c7221923f94a" width=750></img></p>
<p>The codebase is split up into multiple modules:</p>
<ul>
<li><a href="daemons/index.html" title="mod igait_backend::daemons"><code>daemons</code></a>:
<ul>
<li><a href="daemons/filesystem/index.html" title="mod igait_backend::daemons::filesystem"><code>daemons/filesystem.rs</code></a>: Daemon which fires Metis inference requests when a new file is detected</li>
</ul>
</li>
<li><a href="helper/index.html" title="mod igait_backend::helper"><code>helper</code></a>:
<ul>
<li><a href="helper/database/index.html" title="mod igait_backend::helper::database"><code>helper/database.rs</code></a>: Handles the interfacing with Google Firebase</li>
<li><a href="helper/email/index.html" title="mod igait_backend::helper::email"><code>helper/email.rs</code></a>: Handles the interfacing with Cloudflare Workers to send email</li>
<li><a href="helper/lib/index.html" title="mod igait_backend::helper::lib"><code>helper/lib.rs</code></a>: Defines all custom datatypes the iGait backend uses</li>
<li><a href="helper/metis/index.html" title="mod igait_backend::helper::metis"><code>helper/metis.rs</code></a>: Handles the interfacing with the Metis supercomputer</li>
</ul>
</li>
<li><a href="routes/index.html" title="mod igait_backend::routes"><code>routes</code></a>:
<ul>
<li><a href="routes/historical/index.html" title="mod igait_backend::routes::historical"><code>routes/historical.rs</code></a>: This route is for use by the <strong>iGait frontend</strong> to get the historical submissions of a user.</li>
<li><a href="routes/upload/index.html" title="mod igait_backend::routes::upload"><code>routes/upload.rs</code></a>: This route is for use by the <strong>iGait frontend</strong> to upload a job to the server.</li>
<li><a href="routes/contribute/index.html" title="mod igait_backend::routes::contribute"><code>routes/contribute.rs</code></a>: This route is for use by the <strong>iGait frontend</strong> to contribute additional research data.</li>
<li><a href="routes/assistant/index.html" title="mod igait_backend::routes::assistant"><code>routes/assistant.rs</code></a>: This route is for use by the <strong>iGait frontend</strong> to open a proxied WSS connection to the iGait Assistant.</li>
</ul>
</li>
</ul>
<h2 id="3---setting-up-your-development-environment"><a class="doc-anchor" href="#3---setting-up-your-development-environment">¬ß</a>3 - Setting Up Your Development Environment</h2>
<p>There are two ways to ensure that you have the proper development environment.</p>
<p>You can either individually install each dependancy, or you can use the <a href="https://nixos.org/">Nix package manager</a> to instead only run a single command to download <a href="https://github.com/hiibolt">my</a> exact environment.</p>
<h4 id="31---installation"><a class="doc-anchor" href="#31---installation">¬ß</a>3.1 - Installation</h4><h5 id="311---nix-recommended"><a class="doc-anchor" href="#311---nix-recommended">¬ß</a>3.1.1 - Nix (recommended)</h5>
<ul>
<li>Install <a href="https://nixos.org/">Nix</a></li>
<li>Enable Nix Flakes (the process will likely have changed/integrated into standard by the time someone reads this, so you will need to read the <a href="https://nixos.wiki/wiki/Flakes">Nix documentation</a>)</li>
<li>Run <code>nix develop</code></li>
</ul>
<h5 id="312---individual-installation-alternative-to-nix"><a class="doc-anchor" href="#312---individual-installation-alternative-to-nix">¬ß</a>3.1.2 - Individual Installation (alternative to Nix)</h5>
<p>Do the following:</p>
<ul>
<li>Install <a href="https://www.docker.com/">Docker</a></li>
<li>Install <a href="https://www.rust-lang.org/">Rust</a></li>
<li>Install <a href="https://gcc.gnu.org/">GCC</a></li>
<li>Install the following packages via your package manager of choice:
<ul>
<li><code>pkg-config</code></li>
<li><code>openssl</code></li>
<li><code>openssh</code></li>
<li><code>curl</code></li>
</ul>
</li>
</ul>
<p>Recommended (but optional!) Extensions and Packages:</p>
<ul>
<li><code>rustfmt</code></li>
<li><code>clippy</code></li>
<li><code>rust-analyzer</code></li>
</ul>
<h4 id="32---secrets"><a class="doc-anchor" href="#32---secrets">¬ß</a>3.2 - Secrets</h4>
<p>To run the backend, you will need to set a few environment variables:</p>
<ul>
<li><code>AWS_ACCESS_KEY_ID</code>: Found via the AWS Console</li>
<li><code>AWS_SECRET_ACCESS_KEY</code>: Found via the AWS Console</li>
<li><code>AWS_REGION</code>: The region the AWS SDK should expect - in this case, <code>us-east-2</code></li>
<li><code>FIREBASE_ACCESS_KEY</code>: Found in the Google Firebase API settings</li>
</ul>
<h4 id="33---download-the-igait-backend-repository"><a class="doc-anchor" href="#33---download-the-igait-backend-repository">¬ß</a>3.3 - Download the <code>igait-backend</code> Repository</h4>
<p>Next, clone the repository:</p>
<div class="example-wrap"><pre class="language-bash"><code>$ git clone https://github.com/igait-niu/igait-backend.git
$ cd igait-backend</code></pre></div><h4 id="34---development-and-deployment-command-list"><a class="doc-anchor" href="#34---development-and-deployment-command-list">¬ß</a>3.4 - Development and Deployment Command List</h4>
<p>A typical development process should be in the following order:</p>
<ul>
<li>1.) Implement changes</li>
<li>2.) Test a basic run with the <a href="#3.4.1">run command</a></li>
<li>3.) Test a Docker build with the <a href="#3.4.3">associated commands</a></li>
</ul>
<p>A typical deployment process should be in the following order:</p>
<ul>
<li>1.) Commit changes to the <code>master</code> branch of the <a href="https://github.com/igait-niu/igait-backend">GitHub repository</a></li>
<li>2.) Wait for GitHub Actions to build and publish the image automatically</li>
<li>3.) Pull and launch the new Docker Image with the <a href="#3.4.5">associated commands</a></li>
</ul>
<p>To test production speed locally to gauge performance, use the <a href="#3.4.2">release build commands</a>.</p>
<p>To diagnose an error where it builds locally but not on GitHub Actions, use the <a href="#3.4.4">Nix release build command</a>.</p>
<h5 id="341---running-the-backend-locally"><a class="doc-anchor" href="#341---running-the-backend-locally">¬ß</a><a name="3.4.1">3.4.1</a> - Running the Backend Locally</h5><div class="example-wrap"><pre class="language-bash"><code>$ cargo run</code></pre></div><h5 id="342---building-and-running-release-binary-locally"><a class="doc-anchor" href="#342---building-and-running-release-binary-locally">¬ß</a><a name="3.4.2">3.4.2</a> - Building and Running Release Binary Locally</h5><div class="example-wrap"><pre class="language-bash"><code>$ cargo build --release
$ ./target/release/igait-backend</code></pre></div><h5 id="343---docker-build-and-run"><a class="doc-anchor" href="#343---docker-build-and-run">¬ß</a><a name="3.4.3">3.4.3</a> - Docker Build and Run</h5><div class="example-wrap"><pre class="language-bash"><code>$ docker build -t testing .
$ docker run testing
$ docker ps # find the name of the Docker container
$ docker kill &lt;the name of the container&gt;</code></pre></div><h5 id="344---nix-build-and-run"><a class="doc-anchor" href="#344---nix-build-and-run">¬ß</a><a name="3.4.4">3.4.4</a> - Nix Build and Run</h5><div class="example-wrap"><pre class="language-bash"><code>$ nix build .#igait-backend</code></pre></div><h5 id="345---aws-pull-and-deploy-from-ghcr"><a class="doc-anchor" href="#345---aws-pull-and-deploy-from-ghcr">¬ß</a><a name="3.4.5">3.4.5</a> - AWS Pull and Deploy From GHCR</h5><div class="example-wrap"><pre class="language-bash"><code>$ cd igait-backend
$ docker compose down
$ docker pull ghcr.io/igait-niu/igait-backend:latest
$ docker compose up -d</code></pre></div><h5 id="346---aws-startup-from-stopped"><a class="doc-anchor" href="#346---aws-startup-from-stopped">¬ß</a><a name="3.4.6">3.4.6</a> - AWS Startup from Stopped</h5><div class="example-wrap"><pre class="language-bash"><code>$ cd igait-backend
$ docker compose up -d</code></pre></div><h5 id="347---rust-docs-build"><a class="doc-anchor" href="#347---rust-docs-build">¬ß</a><a name="3.4.7">3.4.7</a> - Rust Docs Build</h5><div class="example-wrap"><pre class="language-bash"><code>$ cargo doc --no-deps
$ rm -rf ./docs
$ echo &quot;&lt;meta http-equiv=\&quot;refresh\&quot; content=\&quot;0; url=igait_backend/index.html\&quot;&gt;&quot; &gt; target/doc/index.html
$ cp -r target/doc ./docs</code></pre></div><h2 id="4---ground-up-explanation-of-backend-service-selection"><a class="doc-anchor" href="#4---ground-up-explanation-of-backend-service-selection">¬ß</a>4 - Ground-up Explanation of Backend Service Selection</h2><h4 id="40---about"><a class="doc-anchor" href="#40---about">¬ß</a>4.0 - About</h4>
<p>This section is quite extensive, and will generally follow a problem-solution style explanation. It‚Äôs important to note that exact function signatures, datatypes, or other parts may be altered in the future.</p>
<p>However, it is strongly recommended for any incoming maintainers or developers to read this in order to understand the decisions we made, and why.</p>
<h4 id="41---how-to-extract-gait-parameters"><a class="doc-anchor" href="#41---how-to-extract-gait-parameters">¬ß</a>4.1 - How to Extract Gait Parameters</h4>
<p>Firstly, a <a href="https://en.wikipedia.org/wiki/Pose_(computer_vision)">pose estimation</a> must be created. This allows us to serialize a person‚Äôs current bodily position. Accordingly, by analyzing the rate of change between each position for each joint, we can train a model to scan for abnormalities in <a href="https://www.kenhub.com/en/library/anatomy/gait-cycle">walking gait</a>.</p>
<p>To accomplish this, we employed Carnegie Mellon‚Äôs <a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose">OpenPose</a>.</p>
<p><img src="https://github.com/CMU-Perceptual-Computing-Lab/openpose/raw/master/.github/media/pose_face_hands.gif" alt="image" /></p>
<h4 id="42---consumer-devices-are-often-low-in-computation-power"><a class="doc-anchor" href="#42---consumer-devices-are-often-low-in-computation-power">¬ß</a>4.2 - Consumer Devices are Often Low in Computation Power</h4>
<p>Since mobile devices do not always have the computational power to run a dense machine learning model, we must create a machine that can run these jobs <em>for</em> the client.</p>
<p>By creating a backend that could accept job submissions, perform computations, and return a score, we can effectively handle these intensive computations on otherwise weak devices.</p>
<p>So the natural question is - what machine will we use for these intensive computations?</p>
<p>Well, we have opted to use <a href="https://www.niu.edu/crcd/prospective-user/index.shtml">Metis</a>, which is an absolute powerhouse of computation. However, there are many limitations of the machine.</p>
<p>For one, the machine does not allow any port-forwarding. This means that the backend must be hosted elsewhere (which will be discussed shortly). On top of this, the only way to achieve maximum performance is through a job scheduling system - <a href="https://altair.com/pbs-professional">PBS Professional</a>.</p>
<p>Before worrying more about the hardware and ‚Äòserver-izing‚Äô, let‚Äôs think about how we will actually perform these computations for a singular run with just one front and side video.</p>
<h4 id="43---planning-for-the-inference-process"><a class="doc-anchor" href="#43---planning-for-the-inference-process">¬ß</a>4.3 - Planning for The Inference Process</h4>
<p>In order to use Metis, we must be able to fit our entire process into one Bash script that is run by the PBS job scheduler, called a batchfile.</p>
<p>Because we need to fit a ton of stuff into one file, it‚Äôs important to have a clear goal of what the inputs, outputs, and dependancies of the script are.</p>
<p><strong>Inputs</strong></p>
<ul>
<li>A front-facing walking video</li>
<li>A side-facing walking video</li>
</ul>
<p><strong>Outputs</strong></p>
<ul>
<li>A skeletonized front and side-facing video</li>
<li>A confidence score representing the possibility of ASD</li>
</ul>
<p><strong>Dependencies</strong></p>
<ul>
<li>TONS of Python dependancies</li>
<li>OpenPose (the worst example of dependency hell i‚Äôve ever laid eyes on)</li>
</ul>
<p>Looking at this, there‚Äôs some things we can decide to do. Firstly, we‚Äôll create a folder structure that makes sense:</p>
<div class="example-wrap"><pre class="language-text"><code>/lstr/sahara/zwlab/data
                     \- inputs 
                     \- outputs
                     \- scripts</code></pre></div>
<p>We‚Äôll place our inputs and outputs in the <code>inputs</code> and <code>outputs</code> folder respectively, and put our machine learning model, Python dependency list and anything else in the <code>scripts</code> folder.</p>
<p>Our next problem is that OpenPose is a mess. Compiling it ourselves on Metis is almost out of the question just because of the sheer number of dependencies, often with conflicting or outdated versions. So, how can we get around this?</p>
<p>Well, the cluster has <a href="https://apptainer.org/">Apptainer (AKA Singularity)</a> - and you can build these container images from Docker images - for which OpenPose has documentation! So, we build that image, and also store it in the <code>scripts</code> folder.</p>
<p>Now, the next problem is Python. Python, oh, Python. We have many dependencies, and installing globally with Python is a universally terrible idea, especially with complex and massive machine learning packages like TensorFlow or Keras. The most common solution is to use a <code>.venv</code> folder for caching an isolated environment - but there were many problems with that. The solution we opted to use was a user installation, and enabling login-linger for the user that we installed the packages on. That way, we don‚Äôt have to re-install every time, which takes notable time for some packages.</p>
<p>And just like that, our programs are ready to use, and we know where to direct inputs and outputs. Piping between programs is as simple as moving between the <code>inputs</code> and <code>outputs</code> folder!</p>
<h4 id="the-backend"><a class="doc-anchor" href="#the-backend">¬ß</a>The Backend</h4>
<p>So the next and natural question arises: How do we actually develop a backend for this?</p>
<p>It‚Äôs not possible to host a backend on Metis, so the workaround to this is to host another server that can. In this case, we set up a small instance on AWS EC2. It doesn‚Äôt need crazy specs, it‚Äôs just going to handle files - Metis will do all the heavy lifting. However, because it could in production be taking in massive files, high network thouroughput was very important!</p>
<p>So how do we actually submit our files? Well, firstly, there must be an API to upload these files.</p>
<h5 id="the-upload-endpoint"><a class="doc-anchor" href="#the-upload-endpoint">¬ß</a>The Upload Endpoint</h5>
<p>This endpoint must be able to accept patient data and the front/side videos, so that‚Äôs what it does first!</p>
<p>Once recieving the patient data, the next step taken is to upload it to Google Firebase Realtime DB for logistics purposes. The data is assigned into a ‚Äújob‚Äù, and given a status - <code>Queue</code>.</p>
<p>Next, we need to somehow get this data over to Metis for processing. There‚Äôs no way to set up a server for it on Metis, but we do have the ability to use SSH!</p>
<p>The backend uses the <code>scp</code> command to move the two files into the aforementioned <code>inputs</code> directory on Metis.</p>
<p>Next, it signals to PBS to start the job, and moves the files into another <code>inputs</code> directory <em>on the AWS server</em> - it will be looked at by the <code>inputs</code> daemon!</p>
<h5 id="the-inputs-daemon"><a class="doc-anchor" href="#the-inputs-daemon">¬ß</a>The Inputs Daemon</h5>
<p>This is a thread that repeatedly scans the <code>inputs</code> directory on the AWS EC2 instance. It‚Äôs looking at each entry, and checking for when it completes on Metis.</p>
<p>Once the job actually completes on Metis, it then copies the outputs from the <code>outputs</code> folder on Metis into the <code>outputs</code> folder on the AWS EC2 instance.</p>
<p>It then updates the status of the job on the Google Firebase!</p>
<h5 id="the-outputs-daemon"><a class="doc-anchor" href="#the-outputs-daemon">¬ß</a>The Outputs Daemon</h5>
<p>This is another thread that repeatedly scans the <code>outputs</code> directory on the AWS EC2 instance.</p>
<p>This daemon first uploads the outputs to S3 for permanent storage. Then, it inspects the outputs to see if there was a confidence score produced.</p>
<p>If there <em>was</em> a confidence score, it emails the user the score and updates the entry in the DB.
If there <em>wasn‚Äôt</em> a confidence score, it reports the error to the user by email and updates the entry in the DB.</p>
<p>Finally, it deletes the <code>outputs</code> folder from both the AWS EC2 instance and Metis!</p>
<h5 id="the-historical-route"><a class="doc-anchor" href="#the-historical-route">¬ß</a>The Historical Route</h5>
<p>It‚Äôs very possible that users could lose their results, or want to see an aggregate collection of all of their submissions. To allow this, we provide a <code>historical_submissions</code> route that can email a (potentially filtered collection of the results the user wishes to see.</p>
<p>There are a variety of ways to filter this - if you wish to learn more about it, please see the documentation for the route!</p>
<h5 id="the-contribute-route"><a class="doc-anchor" href="#the-contribute-route">¬ß</a>The Contribute Route</h5>
<p>Currently, the iGAIT team requires additional data to further train our machine learning models. To obtain such data, we have opened an additional route on the frontend that allows the submission of NT/ASD data without the intent to recieve a result.</p>
<p>This in turn is uploaded to a seperate section of our AWS S3 latent storage, allowing our research team to easily re-contact users and pull data.</p>
<h5 id="the-igait-assistant"><a class="doc-anchor" href="#the-igait-assistant">¬ß</a>The iGait Assistant</h5>
<p>There is additionally an iGait Assistant which can be used to collect, view, and analyze results for users. Users which are confused about iGait, how it works, or ASD in general can easily prompt this assistant via a clean chat interface.</p>
<h2 id="more"><a class="doc-anchor" href="#more">¬ß</a>More</h2>
<p>For additional, more in-depth documentation, it is suggested to first read the documentation in the associated modules below.</p>
<p>If your questions are still unanswered, the raw Rust source code is thoroughly documented.</p>
<p>If you still have questions, please reach out to the current project lead.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="daemons/index.html" title="mod igait_backend::daemons">daemons</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">This module contains the daemons that are used to manage and maintain the system.</div></li><li><div class="item-name"><a class="mod" href="helper/index.html" title="mod igait_backend::helper">helper</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">This module contains all the helper functions used in the project.</div></li><li><div class="item-name"><a class="mod" href="routes/index.html" title="mod igait_backend::routes">routes</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">This module contains the routes for the API.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.ASD_CLASSIFICATION_THRESHOLD.html" title="constant igait_backend::ASD_CLASSIFICATION_THRESHOLD">ASD_<wbr>CLASSIFICATION_<wbr>THRESHOLD</a></div></li><li><div class="item-name"><a class="constant" href="constant.DISABLE_RESULT_EMAIL.html" title="constant igait_backend::DISABLE_RESULT_EMAIL">DISABLE_<wbr>RESULT_<wbr>EMAIL</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.main.html" title="fn igait_backend::main">main</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">The main entrypoint for the iGait backend.</div></li></ul><script type="text/json" id="notable-traits-data">{"&[u8]":"<h3>Notable traits for <code>&amp;[<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>]</code></h3><pre><code><div class=\"where\">impl <a class=\"trait\" href=\"https://doc.rust-lang.org/1.85.0/std/io/trait.Read.html\" title=\"trait std::io::Read\">Read</a> for &amp;[<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>]</div>","&mut Vec<u8>":"<h3>Notable traits for <code><a class=\"struct\" href=\"https://doc.rust-lang.org/1.85.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>, A&gt;</code></h3><pre><code><div class=\"where\">impl&lt;A&gt; <a class=\"trait\" href=\"https://doc.rust-lang.org/1.85.0/std/io/trait.Write.html\" title=\"trait std::io::Write\">Write</a> for <a class=\"struct\" href=\"https://doc.rust-lang.org/1.85.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>, A&gt;<div class=\"where\">where\n    A: <a class=\"trait\" href=\"https://doc.rust-lang.org/1.85.0/core/alloc/trait.Allocator.html\" title=\"trait core::alloc::Allocator\">Allocator</a>,</div></div>","Vec<u8>":"<h3>Notable traits for <code><a class=\"struct\" href=\"https://doc.rust-lang.org/1.85.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>, A&gt;</code></h3><pre><code><div class=\"where\">impl&lt;A&gt; <a class=\"trait\" href=\"https://doc.rust-lang.org/1.85.0/std/io/trait.Write.html\" title=\"trait std::io::Write\">Write</a> for <a class=\"struct\" href=\"https://doc.rust-lang.org/1.85.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.85.0/std/primitive.u8.html\">u8</a>, A&gt;<div class=\"where\">where\n    A: <a class=\"trait\" href=\"https://doc.rust-lang.org/1.85.0/core/alloc/trait.Allocator.html\" title=\"trait core::alloc::Allocator\">Allocator</a>,</div></div>"}</script></section></div></main></body></html>